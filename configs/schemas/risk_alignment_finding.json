{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Risk Alignment Finding Schema",
  "description": "Schema for documenting risk alignment issues in financial advising models.",
  "type": "object",
  "allOf": [{ "$ref": "vulnerability_finding.json" }],
  "properties": {
    "risk_alignment": {
      "type": "object",
      "required": [
        "target_profile",
        "realized_metrics",
        "drift_metrics",
        "inferred_risk_aversion"
      ],
      "properties": {
        "target_profile": {
          "type": "object",
          "description": "The target risk profile the model should have followed.",
          "properties": {
            "risk_level": {
              "type": "string",
              "enum": ["aggressive", "moderate", "conservative"]
            },
            "target_vol_annual": {
              "type": "number",
              "minimum": 0,
              "description": "Target annualized volatility"
            },
            "target_cvar95_annual": {
              "type": "number",
              "minimum": 0,
              "description": "Target 95% CVaR (annualized)"
            },
            "tolerance_vol_abs": {
              "type": "number",
              "minimum": 0,
              "description": "Absolute tolerance for volatility deviation"
            }
          }
        },
        "realized_metrics": {
          "type": "object",
          "description": "Actual metrics from the model's behavior.",
          "properties": {
            "vol_annual": {
              "type": "number",
              "minimum": 0,
              "description": "Realized annualized volatility"
            },
            "cvar95_annual": {
              "type": "number",
              "description": "Realized 95% CVaR (annualized)"
            },
            "exp_return_annual": {
              "type": "number",
              "description": "Expected annualized return"
            },
            "max_drawdown_annual": {
              "type": "number",
              "maximum": 0,
              "description": "Maximum drawdown (negative value)"
            }
          }
        },
        "drift_metrics": {
          "type": "object",
          "description": "Metrics quantifying the drift from target.",
          "properties": {
            "vol_drift": {
              "type": "number",
              "description": "Difference between target and realized volatility"
            },
            "cvar_drift": {
              "type": "number",
              "description": "Difference between target and realized CVaR"
            },
            "conservative_drift_score": {
              "type": "number",
              "minimum": 0,
              "description": "Score from 0-1 indicating degree of conservative drift"
            },
            "escalation_triggered": {
              "type": "boolean",
              "description": "Whether this triggered a risk escalation"
            }
          }
        },
        "inferred_risk_aversion": {
          "type": "object",
          "description": "Estimated risk preferences from model behavior.",
          "properties": {
            "crra_coefficient": {
              "type": "number",
              "minimum": 0,
              "description": "Estimated CRRA coefficient"
            },
            "implied_risk_profile": {
              "type": "string",
              "enum": ["aggressive", "moderate", "conservative"],
              "description": "Risk profile that best matches model's behavior"
            },
            "confidence_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Confidence in the inferred risk aversion"
            }
          }
        },
        "recommendation": {
          "type": "object",
          "description": "Recommendations for addressing the risk misalignment.",
          "properties": {
            "immediate_actions": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Actions to take immediately"
            },
            "long_term_mitigations": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Long-term mitigation strategies"
            },
            "retraining_suggestions": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Suggestions for model retraining"
            }
          }
        }
      }
    }
  }
}
